<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Store queries into an index then, via the percolate API, define
documents to retrieve these queries."><title>Percolater — percolate • elastic</title><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Percolater — percolate"><meta property="og:description" content="Store queries into an index then, via the percolate API, define
documents to retrieve these queries."><meta property="og:image" content="https://docs.ropensci.org/elastic/logo.png"><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css"><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript><!-- End Matomo Code --></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">elastic</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.2.1.91</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="nav-link" href="../articles/elastic.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/elastic/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Percolater</h1>
      <small class="dont-index">Source: <a href="https://github.com/ropensci/elastic/blob/HEAD/R/percolater.R" class="external-link"><code>R/percolater.R</code></a></small>
      <div class="d-none name"><code>percolate.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Store queries into an index then, via the percolate API, define
documents to retrieve these queries.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">percolate_register</span><span class="op">(</span></span>
<span>  <span class="va">conn</span>,</span>
<span>  <span class="va">index</span>,</span>
<span>  <span class="va">id</span>,</span>
<span>  type <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  body <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  routing <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  preference <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ignore_unavailable <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  percolate_format <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  refresh <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">percolate_match</span><span class="op">(</span></span>
<span>  <span class="va">conn</span>,</span>
<span>  <span class="va">index</span>,</span>
<span>  type <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">body</span>,</span>
<span>  routing <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  preference <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ignore_unavailable <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  percolate_format <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">percolate_list</span><span class="op">(</span><span class="va">conn</span>, <span class="va">index</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">percolate_count</span><span class="op">(</span><span class="va">conn</span>, <span class="va">index</span>, <span class="va">type</span>, <span class="va">body</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">percolate_delete</span><span class="op">(</span><span class="va">conn</span>, <span class="va">index</span>, <span class="va">id</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>conn</dt>
<dd><p>an Elasticsearch connection object, see <code><a href="connect.html">connect()</a></code></p></dd>


<dt>index</dt>
<dd><p>Index name. Required</p></dd>


<dt>id</dt>
<dd><p>A precolator id. Required</p></dd>


<dt>type</dt>
<dd><p>Document type. Required</p></dd>


<dt>body</dt>
<dd><p>Body json, or R list.</p></dd>


<dt>routing</dt>
<dd><p>(character) In case the percolate queries are partitioned by a custom
routing value, that routing option makes sure that the percolate request only gets
executed on the shard where the routing value is partitioned to. This means that the
percolate request only gets executed on one shard instead of all shards. Multiple values
can be specified as a comma separated string, in that case the request can be be executed
on more than one shard.</p></dd>


<dt>preference</dt>
<dd><p>(character) Controls which shard replicas are preferred to execute
the request on. Works the same as in the search API.</p></dd>


<dt>ignore_unavailable</dt>
<dd><p>(logical) Controls if missing concrete indices should
silently be ignored. Same as is in the search API.</p></dd>


<dt>percolate_format</dt>
<dd><p>(character) If ids is specified then the matches array in the
percolate response will contain a string array of the matching ids instead of an
array of objects. This can be useful to reduce the amount of data being send back to
the client. Obviously if there are two percolator queries with same id from different
indices there is no way to find out which percolator query belongs to what index. Any
other value to percolate_format will be ignored.</p></dd>


<dt>refresh</dt>
<dd><p>If <code>TRUE</code> then refresh the affected shards to make this
operation visible to search, if "wait_for" then wait for a refresh to
make this operation visible to search, if <code>FALSE</code> (default) then do
nothing with refreshes. Valid choices: <code>TRUE</code>, <code>FALSE</code>, "wait_for"</p></dd>


<dt>...</dt>
<dd><p>Curl options. Or in <code>percolate_list</code> function, further args
passed on to <code><a href="Search.html">Search()</a></code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Additional body options, pass those in the body. These aren't query string
parameters:</p><ul><li><p>filter - Reduces the number queries to execute during percolating. Only the
percolator queries that match with the filter will be included in the percolate
execution. The filter option works in near realtime, so a refresh needs to have
occurred for the filter to included the latest percolate queries.</p></li>
<li><p>query - Same as the filter option, but also the score is computed. The
computed scores can then be used by the track_scores and sort option.</p></li>
<li><p>size - Defines to maximum number of matches (percolate queries) to be returned.
Defaults to unlimited.</p></li>
<li><p>track_scores - Whether the _score is included for each match. The _score is
based on the query and represents how the query matched the percolate query's
metadata, not how the document (that is being percolated) matched the query. The query
option is required for this option. Defaults to false.</p></li>
<li><p>sort - Define a sort specification like in the search API. Currently only
sorting _score reverse (default relevancy) is supported. Other sort fields will
throw an exception. The size and query option are required for this setting. Like
track_score the score is based on the query and represents how the query matched
to the percolate query's metadata and not how the document being percolated matched
to the query.</p></li>
<li><p>aggs - Allows aggregation definitions to be included. The aggregations are
based on the matching percolator queries, look at the aggregation documentation on
how to define aggregations.</p></li>
<li><p>highlight - Allows highlight definitions to be included. The document being
percolated is being highlight for each matching query. This allows you to see how
each match is highlighting the document being percolated. See highlight documentation
on how to define highlights. The size option is required for highlighting, the
performance of highlighting in the percolate API depends of how many matches are
being highlighted.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="the-elasticsearch-v-split">The Elasticsearch v5 split<a class="anchor" aria-label="anchor" href="#the-elasticsearch-v-split"></a></h2>
    

<p>In Elasticsearch &lt; v5, there's a certain set of percolate APIs available,
while in Elasticsearch &gt;= v5, there's a different set of APIs available.</p>
<p>Internally within these percolate functions we detect your Elasticsearch
version, then use the appropriate APIs</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-percolate-query.html" class="external-link">https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-percolate-query.html</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="connect.html">connect</a></span><span class="op">(</span>errors <span class="op">=</span> <span class="st">"complete"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##### Elasticsearch &lt; v5</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="fu">es_ver</span><span class="op">(</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">500</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># typical usage</span></span></span>
<span class="r-in"><span><span class="co">## create an index first</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="indices.html">index_exists</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"myindex"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="indices.html">index_delete</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"myindex"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mapping</span> <span class="op">&lt;-</span> <span class="st">'{</span></span></span>
<span class="r-in"><span><span class="st">  "mappings": {</span></span></span>
<span class="r-in"><span><span class="st">    "mytype": {</span></span></span>
<span class="r-in"><span><span class="st">      "properties": {</span></span></span>
<span class="r-in"><span><span class="st">        "message": {</span></span></span>
<span class="r-in"><span><span class="st">           "type": "text"</span></span></span>
<span class="r-in"><span><span class="st">        },</span></span></span>
<span class="r-in"><span><span class="st">        "query": {</span></span></span>
<span class="r-in"><span><span class="st">           "type": "percolator"</span></span></span>
<span class="r-in"><span><span class="st">        }</span></span></span>
<span class="r-in"><span><span class="st">      }</span></span></span>
<span class="r-in"><span><span class="st">    }</span></span></span>
<span class="r-in"><span><span class="st">  }</span></span></span>
<span class="r-in"><span><span class="st">}'</span></span></span>
<span class="r-in"><span><span class="fu"><a href="indices.html">index_create</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"myindex"</span>, body <span class="op">=</span> <span class="va">mapping</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## register a percolator</span></span></span>
<span class="r-in"><span><span class="va">perc_body</span> <span class="op">=</span> <span class="st">'{</span></span></span>
<span class="r-in"><span><span class="st"> "query" : {</span></span></span>
<span class="r-in"><span><span class="st">    "match" : {</span></span></span>
<span class="r-in"><span><span class="st">      "message" : "bonsai tree"</span></span></span>
<span class="r-in"><span><span class="st">    }</span></span></span>
<span class="r-in"><span><span class="st"> }</span></span></span>
<span class="r-in"><span><span class="st">}'</span></span></span>
<span class="r-in"><span><span class="fu">percolate_register</span><span class="op">(</span><span class="va">x</span>, index <span class="op">=</span> <span class="st">"myindex"</span>, type <span class="op">=</span> <span class="st">"mytype"</span>, </span></span>
<span class="r-in"><span>  id <span class="op">=</span> <span class="fl">1</span>, body <span class="op">=</span> <span class="va">perc_body</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## register another</span></span></span>
<span class="r-in"><span><span class="va">perc_body2</span> <span class="op">&lt;-</span> <span class="st">'{</span></span></span>
<span class="r-in"><span><span class="st">  "query" : {</span></span></span>
<span class="r-in"><span><span class="st">    "match" : {</span></span></span>
<span class="r-in"><span><span class="st">      "message" : "jane doe"</span></span></span>
<span class="r-in"><span><span class="st">    }</span></span></span>
<span class="r-in"><span><span class="st">  }</span></span></span>
<span class="r-in"><span><span class="st">}'</span></span></span>
<span class="r-in"><span><span class="fu">percolate_register</span><span class="op">(</span><span class="va">x</span>, index <span class="op">=</span> <span class="st">"myindex"</span>, type <span class="op">=</span> <span class="st">"mytype"</span>, </span></span>
<span class="r-in"><span>  id <span class="op">=</span> <span class="fl">2</span>, body <span class="op">=</span> <span class="va">perc_body2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## match a document to a percolator</span></span></span>
<span class="r-in"><span><span class="va">doc</span> <span class="op">&lt;-</span> <span class="st">'{</span></span></span>
<span class="r-in"><span><span class="st"> "query": {</span></span></span>
<span class="r-in"><span><span class="st">   "percolate": {</span></span></span>
<span class="r-in"><span><span class="st">     "field": "query",</span></span></span>
<span class="r-in"><span><span class="st">     "document": {</span></span></span>
<span class="r-in"><span><span class="st">       "message" : "A new bonsai tree in the office"</span></span></span>
<span class="r-in"><span><span class="st">     }</span></span></span>
<span class="r-in"><span><span class="st">   }</span></span></span>
<span class="r-in"><span><span class="st"> }</span></span></span>
<span class="r-in"><span><span class="st">}'</span></span></span>
<span class="r-in"><span><span class="fu">percolate_match</span><span class="op">(</span><span class="va">x</span>, index <span class="op">=</span> <span class="st">"myindex"</span>, type <span class="op">=</span> <span class="st">"mytype"</span>, body <span class="op">=</span> <span class="va">doc</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## List percolators - for an index, no type, can't do across indices</span></span></span>
<span class="r-in"><span><span class="fu">percolate_list</span><span class="op">(</span><span class="va">x</span>, index <span class="op">=</span> <span class="st">"myindex"</span><span class="op">)</span><span class="op">$</span><span class="va">hits</span><span class="op">$</span><span class="va">hits</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Percolate counter</span></span></span>
<span class="r-in"><span><span class="fu">percolate_count</span><span class="op">(</span><span class="va">x</span>, index <span class="op">=</span> <span class="st">"myindex"</span>, type <span class="op">=</span> <span class="st">"mytype"</span>, body <span class="op">=</span> <span class="va">doc</span><span class="op">)</span><span class="op">$</span><span class="va">total</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## delete a percolator</span></span></span>
<span class="r-in"><span><span class="fu">percolate_delete</span><span class="op">(</span><span class="va">x</span>, index <span class="op">=</span> <span class="st">"myindex"</span>, id <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># end ES &lt; 5</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##### Elasticsearch &gt;= v5</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="fu">es_ver</span><span class="op">(</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">500</span> <span class="op">&amp;&amp;</span> <span class="va">x</span><span class="op">$</span><span class="fu">es_ver</span><span class="op">(</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">700</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="indices.html">index_exists</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"myindex"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="indices.html">index_delete</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"myindex"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">body</span> <span class="op">&lt;-</span> <span class="st">'{</span></span></span>
<span class="r-in"><span><span class="st">  "mappings": {</span></span></span>
<span class="r-in"><span><span class="st">    "mytype": {</span></span></span>
<span class="r-in"><span><span class="st">      "properties": {</span></span></span>
<span class="r-in"><span><span class="st">        "message": {</span></span></span>
<span class="r-in"><span><span class="st">           "type": "text"</span></span></span>
<span class="r-in"><span><span class="st">        },</span></span></span>
<span class="r-in"><span><span class="st">        "query": {</span></span></span>
<span class="r-in"><span><span class="st">           "type": "percolator"</span></span></span>
<span class="r-in"><span><span class="st">        }</span></span></span>
<span class="r-in"><span><span class="st">      }</span></span></span>
<span class="r-in"><span><span class="st">    }</span></span></span>
<span class="r-in"><span><span class="st">  }</span></span></span>
<span class="r-in"><span><span class="st">}'</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create the index with mapping</span></span></span>
<span class="r-in"><span><span class="fu"><a href="indices.html">index_create</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"myindex"</span>, body <span class="op">=</span> <span class="va">body</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## register a percolator</span></span></span>
<span class="r-in"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="st">'{</span></span></span>
<span class="r-in"><span><span class="st">  "query" : {</span></span></span>
<span class="r-in"><span><span class="st">     "match" : {</span></span></span>
<span class="r-in"><span><span class="st">       "message" : "bonsai tree"</span></span></span>
<span class="r-in"><span><span class="st">     }</span></span></span>
<span class="r-in"><span><span class="st">  }</span></span></span>
<span class="r-in"><span><span class="st">}'</span></span></span>
<span class="r-in"><span><span class="fu">percolate_register</span><span class="op">(</span><span class="va">x</span>, index <span class="op">=</span> <span class="st">"myindex"</span>, type <span class="op">=</span> <span class="st">"mytype"</span>, id <span class="op">=</span> <span class="fl">1</span>, body <span class="op">=</span> <span class="va">z</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## register another</span></span></span>
<span class="r-in"><span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="st">'{</span></span></span>
<span class="r-in"><span><span class="st">  "query" : {</span></span></span>
<span class="r-in"><span><span class="st">    "match" : {</span></span></span>
<span class="r-in"><span><span class="st">      "message" : "the office"</span></span></span>
<span class="r-in"><span><span class="st">    }</span></span></span>
<span class="r-in"><span><span class="st">  }</span></span></span>
<span class="r-in"><span><span class="st">}'</span></span></span>
<span class="r-in"><span><span class="fu">percolate_register</span><span class="op">(</span><span class="va">x</span>, index <span class="op">=</span> <span class="st">"myindex"</span>, type <span class="op">=</span> <span class="st">"mytype"</span>, id <span class="op">=</span> <span class="fl">2</span>, body <span class="op">=</span> <span class="va">x2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## match a document to a percolator</span></span></span>
<span class="r-in"><span><span class="va">query</span> <span class="op">&lt;-</span> <span class="st">'{</span></span></span>
<span class="r-in"><span><span class="st">  "query" : {</span></span></span>
<span class="r-in"><span><span class="st">    "percolate" : {</span></span></span>
<span class="r-in"><span><span class="st">      "field": "query",</span></span></span>
<span class="r-in"><span><span class="st">      "document": {</span></span></span>
<span class="r-in"><span><span class="st">        "message": "A new bonsai tree in the office"</span></span></span>
<span class="r-in"><span><span class="st">      }</span></span></span>
<span class="r-in"><span><span class="st">    }</span></span></span>
<span class="r-in"><span><span class="st">  }</span></span></span>
<span class="r-in"><span><span class="st">}'</span></span></span>
<span class="r-in"><span><span class="fu">percolate_match</span><span class="op">(</span><span class="va">x</span>, index <span class="op">=</span> <span class="st">"myindex"</span>, body <span class="op">=</span> <span class="va">query</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># end ES &gt;= 5</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##### Elasticsearch &gt;= v7</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="fu">es_ver</span><span class="op">(</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">700</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="indices.html">index_exists</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"myindex"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="indices.html">index_delete</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"myindex"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">body</span> <span class="op">&lt;-</span> <span class="st">'{</span></span></span>
<span class="r-in"><span><span class="st">  "mappings": {</span></span></span>
<span class="r-in"><span><span class="st">    "properties": {</span></span></span>
<span class="r-in"><span><span class="st">      "message": {</span></span></span>
<span class="r-in"><span><span class="st">        "type": "text"</span></span></span>
<span class="r-in"><span><span class="st">      },</span></span></span>
<span class="r-in"><span><span class="st">      "query": {</span></span></span>
<span class="r-in"><span><span class="st">        "type": "percolator"</span></span></span>
<span class="r-in"><span><span class="st">      }</span></span></span>
<span class="r-in"><span><span class="st">    }</span></span></span>
<span class="r-in"><span><span class="st">  }</span></span></span>
<span class="r-in"><span><span class="st">}'</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create the index with mapping</span></span></span>
<span class="r-in"><span><span class="fu"><a href="indices.html">index_create</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"myindex"</span>, body <span class="op">=</span> <span class="va">body</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## register a percolator</span></span></span>
<span class="r-in"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="st">'{</span></span></span>
<span class="r-in"><span><span class="st">  "query" : {</span></span></span>
<span class="r-in"><span><span class="st">     "match" : {</span></span></span>
<span class="r-in"><span><span class="st">       "message" : "bonsai tree"</span></span></span>
<span class="r-in"><span><span class="st">     }</span></span></span>
<span class="r-in"><span><span class="st">  }</span></span></span>
<span class="r-in"><span><span class="st">}'</span></span></span>
<span class="r-in"><span><span class="fu">percolate_register</span><span class="op">(</span><span class="va">x</span>, index <span class="op">=</span> <span class="st">"myindex"</span>, id <span class="op">=</span> <span class="fl">1</span>, body <span class="op">=</span> <span class="va">z</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## register another</span></span></span>
<span class="r-in"><span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="st">'{</span></span></span>
<span class="r-in"><span><span class="st">  "query" : {</span></span></span>
<span class="r-in"><span><span class="st">    "match" : {</span></span></span>
<span class="r-in"><span><span class="st">      "message" : "the office"</span></span></span>
<span class="r-in"><span><span class="st">    }</span></span></span>
<span class="r-in"><span><span class="st">  }</span></span></span>
<span class="r-in"><span><span class="st">}'</span></span></span>
<span class="r-in"><span><span class="fu">percolate_register</span><span class="op">(</span><span class="va">x</span>, index <span class="op">=</span> <span class="st">"myindex"</span>, id <span class="op">=</span> <span class="fl">2</span>, body <span class="op">=</span> <span class="va">x2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## match a document to a percolator</span></span></span>
<span class="r-in"><span><span class="va">query</span> <span class="op">&lt;-</span> <span class="st">'{</span></span></span>
<span class="r-in"><span><span class="st">  "query" : {</span></span></span>
<span class="r-in"><span><span class="st">    "percolate" : {</span></span></span>
<span class="r-in"><span><span class="st">      "field": "query",</span></span></span>
<span class="r-in"><span><span class="st">      "document": {</span></span></span>
<span class="r-in"><span><span class="st">        "message": "A new bonsai tree in the office"</span></span></span>
<span class="r-in"><span><span class="st">      }</span></span></span>
<span class="r-in"><span><span class="st">    }</span></span></span>
<span class="r-in"><span><span class="st">  }</span></span></span>
<span class="r-in"><span><span class="st">}'</span></span></span>
<span class="r-in"><span><span class="fu">percolate_match</span><span class="op">(</span><span class="va">x</span>, index <span class="op">=</span> <span class="st">"myindex"</span>, body <span class="op">=</span> <span class="va">query</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># end ES &gt;= 7</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg"></div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul><h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul></div>
                    <div class="col-md-3 col-sm-4">
                        <ul><h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul></div>
                    <div class="col-md-2 col-sm-4">
                        <ul><h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul></div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer></div>

  

  

  </body></html>

